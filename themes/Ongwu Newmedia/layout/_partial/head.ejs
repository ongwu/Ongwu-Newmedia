<% if (theme.baidu_analytics && theme.baidu_analytics.enable) { %>
<%- partial('_plugins/baidu-analytics') %>
<% } %>

<!-- 字符集 -->
<meta charset="utf-8">

<!-- 响应式设计 -->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<!-- 标题 -->
<title><% if (is_post || is_page) { %><%= page.title %> | <% } %><%= config.title %></title>

<!-- 元描述 -->
<% if (is_post || is_page) { %>
  <meta name="description" content="<%= page.description || page.title || config.description %>">
<% } else { %>
  <meta name="description" content="<%= config.description %>">
<% } %>

<!-- 关键词 -->
<% if (is_post || is_page) { %>
  <meta name="keywords" content="<%= page.tags ? page.tags.map(tag => tag.name).join(', ') : config.keywords %>">
<% } else { %>
  <meta name="keywords" content="<%= config.keywords %>">
<% } %>

<!-- 作者 -->
<meta name="author" content="<%= config.author %>">

<!-- 内容语言 -->
<meta http-equiv="content-language" content="<%= config.language || 'zh-CN' %>">

<!-- 兼容IE -->
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

<!-- 禁止转码 -->
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<!-- 百度SiteApp -->
<% if (theme.siteapp && theme.siteapp.enable) { %>
  <meta name="siteapp-verification" content="<%= theme.siteapp.baidu %>">
<% } %>

<!-- 360搜索 -->
<% if (theme.so360 && theme.so360.enable) { %>
  <meta name="mobile-agent" content="format=html5;url=<%= url_for('/') %>">
<% } %>

<!-- 谷歌网站验证 -->
<% if (theme.google_site_verification) { %>
  <meta name="google-site-verification" content="<%= theme.google_site_verification %>">
<% } %>

<!-- Bing网站验证 -->
<% if (theme.bing_site_verification) { %>
  <meta name="msvalidate.01" content="<%= theme.bing_site_verification %>">
<% } %>

<!-- 好搜网站验证 -->
<% if (theme.haosou_site_verification) { %>
  <meta name="360-site-verification" content="<%= theme.haosou_site_verification %>">
<% } %>

<!-- 搜狗网站验证 -->
<% if (theme.sogou_site_verification) { %>
  <meta name="sogou_site_verification" content="<%= theme.sogou_site_verification %>">
<% } %>

<!-- Open Graph 协议 -->
<% if (is_post || is_page) { %>
  <meta property="og:title" content="<%= page.title %>">
  <meta property="og:type" content="article">
  <meta property="og:url" content="<%= page.permalink %>">
  <meta property="og:description" content="<%= page.description || page.title || config.description %>">
  <% if (page.thumbnail) { %>
    <meta property="og:image" content="<%= page.thumbnail %>">
  <% } else if (theme.og_image) { %>
    <meta property="og:image" content="<%= theme.og_image %>">
  <% } %>
  <meta property="og:site_name" content="<%= config.title %>">
  <meta property="article:published_time" content="<%= page.date.toISOString() %>">
  <% if (page.updated) { %>
    <meta property="article:modified_time" content="<%= page.updated.toISOString() %>">
  <% } %>
  <meta property="article:author" content="<%= config.author %>">
  <% if (page.categories && page.categories.length > 0) { %>
    <meta property="article:section" content="<%= page.categories[0].name %>">
  <% } %>
  <% if (page.tags && page.tags.length > 0) { %>
    <% page.tags.forEach(tag => { %>
      <meta property="article:tag" content="<%= tag.name %>">
    <% }) %>
  <% } %>
<% } else { %>
  <meta property="og:title" content="<%= config.title %>">
  <meta property="og:type" content="website">
  <meta property="og:url" content="<%= config.url %>">
  <meta property="og:description" content="<%= config.description %>">
  <% if (theme.og_image) { %>
    <meta property="og:image" content="<%= theme.og_image %>">
  <% } %>
  <meta property="og:site_name" content="<%= config.title %>">
<% } %>

<!-- Twitter 卡片 -->
<% if (theme.twitter_card && theme.twitter_card.enable) { %>
  <meta name="twitter:card" content="<%= theme.twitter_card.type || 'summary' %>">
  <meta name="twitter:title" content="<%= is_post || is_page ? page.title : config.title %>">
  <meta name="twitter:description" content="<%= is_post || is_page ? (page.description || page.title || config.description) : config.description %>">
  <% if (theme.twitter_card.username) { %>
    <meta name="twitter:site" content="@<%= theme.twitter_card.username %>">
  <% } %>
  <% if (is_post || is_page && page.thumbnail || theme.og_image) { %>
    <meta name="twitter:image" content="<%= is_post || is_page && page.thumbnail ? page.thumbnail : theme.og_image %>">
  <% } %>
<% } %>

<!-- 引用样式文件 -->

<!-- Font Awesome -->
<% if (theme.fontawesome && theme.fontawesome.enable) { %>
  <link rel="stylesheet" href="<%= theme.fontawesome.url || '//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css' %>">
<% } else { %>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<% } %>

<!-- Google Fonts -->
<% if (theme.google_fonts && theme.google_fonts.enable) { %>
  <link rel="stylesheet" href="<%= theme.google_fonts.url %>">
<% } else { %>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700|Roboto+Slab:400,700">
<% } %>

<!-- 主题样式 -->
<link rel="stylesheet" href="<%- url_for('/css/style.css') %>">

<!-- 响应式样式 -->
<link rel="stylesheet" href="<%- url_for('/css/responsive.css') %>">

<!-- 动画效果 -->
<% if (theme.animation && theme.animation.enable) { %>
  <link rel="stylesheet" href="<%- url_for('/css/animation.css') %>">
<% } %>

<!-- 代码高亮 -->
<% if (theme.highlight && theme.highlight.enable) { %>
  <% if (theme.highlight.prism && theme.highlight.prism.enable) { %>
    <link rel="stylesheet" href="<%= theme.highlight.prism.theme || '//cdn.jsdelivr.net/npm/prismjs/themes/prism.css' %>">
  <% } else { %>
    <link rel="stylesheet" href="<%= theme.highlight.theme || '//cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github.css' %>">
  <% } %>
<% } %>

<!-- 自定义CSS -->
<% if (theme.custom_css && theme.custom_css.length > 0) { %>
  <% theme.custom_css.forEach(css => { %>
    <link rel="stylesheet" href="<%- url_for(css) %>">
  <% }) %>
<% } %>

<!-- 网页图标 -->
<% if (theme.favicon) { %>
  <link rel="icon" href="<%- url_for(theme.favicon) %>" type="image/x-icon">
  <link rel="shortcut icon" href="<%- url_for(theme.favicon) %>" type="image/x-icon">
<% } %>

<!-- Apple Touch 图标 -->
<% if (theme.apple_touch_icon) { %>
  <link rel="apple-touch-icon" href="<%- url_for(theme.apple_touch_icon) %>">
<% } %>

<!-- RSS订阅 -->
<% if (config.feed && config.feed.enable) { %>
  <%- feed_tag(config.feed.path, {title: config.title + ' - RSS Feed'}) %>
<% } else { %>
  <link rel="alternate" type="application/rss+xml" title="<%= config.title %> - RSS Feed" href="<%- url_for('/rss.xml') %>">
<% } %>

<!-- JSON Feed -->
<% if (theme.json_feed && theme.json_feed.enable) { %>
  <link rel="alternate" type="application/json" title="<%= config.title %> - JSON Feed" href="<%- url_for(theme.json_feed.path || '/feed.json') %>">
<% } %>

<!-- 主题配置全局变量 -->
<script>
  // 主题配置
  window.theme = {
    // 基本配置
    site: {
      title: '<%= config.title %>',
      url: '<%= config.url %>',
      description: '<%= config.description %>'
    },
    
    // 语言配置
    language: {
      current: 'zh-CN',
      default: 'zh-CN'
    },
    
    // 动画配置
    animation: {
      enable: <%- JSON.stringify(theme.animation && theme.animation.enable ? true : false) %>,
      page_transition: <%- JSON.stringify(theme.animation && theme.animation.page_transition ? true : false) %>,
      duration: <%- theme.animation && theme.animation.duration || 300 %>
    },
    
    // 懒加载配置
    lazyload: {
      enable: <%- JSON.stringify(theme.lazyload && theme.lazyload.enable ? true : false) %>
    },
    
    // 代码高亮配置
    highlight: {
      enable: <%- JSON.stringify(theme.highlight && theme.highlight.enable ? true : false) %>,
      prism: <%- JSON.stringify(theme.highlight && theme.highlight.prism && theme.highlight.prism.enable ? true : false) %>
    },
    
    // 返回顶部配置
    back2top: {
      enable: <%- JSON.stringify(theme.back2top && theme.back2top.enable ? true : false) %>,
      threshold: <%- theme.back2top && theme.back2top.threshold || 500 %>,
      duration: <%- theme.back2top && theme.back2top.duration || 300 %>
    },
    
    // 分享配置
    share: {
      enable: <%- JSON.stringify(theme.share && theme.share.enable ? true : false) %>,
      platforms: <%- theme.share && theme.share.platforms ? JSON.stringify(theme.share.platforms) : '[]' %>
    },
    
    // 评论配置
    comment: {
      enable: <%- JSON.stringify(theme.comment && theme.comment.enable ? true : false) %>,
      type: '<%= theme.comment && theme.comment.type || '' %>'
    },
    
    // 百度统计配置
    baidu_analytics: {
      enable: <%- JSON.stringify(theme.baidu_analytics && theme.baidu_analytics.enable ? true : false) %>
    }
  };
</script>

<!-- 页面特定数据 -->
<% if (is_post || is_page) { %>
  <script>
    // 页面数据
    window.pageData = {
      id: '<%= page._id || page.path %>',
      title: '<%= page.title %>',
      path: '<%= page.path %>',
      url: '<%= page.permalink %>',
      date: '<%= page.date.toISOString() %>',
      <% if (page.updated) { %>
      updated: '<%= page.updated.toISOString() %>',
      <% } %>
      categories: <%= page.categories ? JSON.stringify(page.categories.map(cat => cat.name)) : '[]' %>,
      tags: <%= page.tags ? JSON.stringify(page.tags.map(tag => tag.name)) : '[]' %>
    };
  </script>
<% } %>