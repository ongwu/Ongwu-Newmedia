<!-- 导航栏 -->
<header class="navbar">
  <div class="container navbar-container">
    <!-- 网站标志 -->
    <div class="navbar-brand">
      <a href="<%- url_for('/') %>" class="logo">
        <% if (theme.logo && theme.logo.enable) { %>
          <img src="<%- url_for(theme.logo.path) %>" alt="<%= config.title %>" class="logo-image">
        <% } else { %>
          <span class="logo-text"><i class="fab fa-windows" style="margin-right: 8px; color: #0078D7;"></i><%= config.title %></span>
        <% } %>
        <% if (theme.subtitle && theme.subtitle.enable) { %>
          <span class="logo-subtitle"><%= theme.subtitle.text %></span>
        <% } %>
      </a>
    </div>
    
    <!-- 桌面端导航菜单 -->
    <nav class="navbar-nav">
      <ul>
        <!-- 首页 -->
        <li class="nav-item<%= is_home() ? ' active' : '' %>">
          <a href="<%- url_for('/') %>" class="nav-link" data-translate="首页">首页</a>
        </li>
        

        
        <!-- 分类菜单 -->
        <% if (theme.theme_settings && theme.theme_settings.navbar && theme.theme_settings.navbar.menu) { %>
          <% Object.keys(theme.theme_settings.navbar.menu).forEach(function(key) { %>
            <li class="nav-item<%= is_current(theme.theme_settings.navbar.menu[key]) ? ' active' : '' %>">
              <a href="<%- url_for(theme.theme_settings.navbar.menu[key]) %>" class="nav-link" data-translate="<%= key %>"><%= key %></a>
            </li>
          <% }); %>
        <% } %>
        
      </ul>
    </nav>
    
    <!-- 右侧元素容器 -->
    <div class="navbar-right">
      <!-- 搜索按钮 -->
      <button type="button" class="search-button" id="search-button" title="搜索">
        <i class="fas fa-search"></i>
      </button>
      
      <!-- 移动端菜单按钮 -->
      <button class="mobile-menu-btn mobile-only" id="mobile-menu-btn">
        <i class="fa fa-bars"></i>
      </button>
    </div>
  </div>
  
  <!-- 移动端菜单 -->
  <div class="mobile-menu" id="mobile-menu">
    <ul>
      <!-- 首页 -->
      <li<%= is_home() ? ' class="active"' : '' %>>
        <a href="<%- url_for('/') %>" data-translate="首页">首页</a>
      </li>
      
      <!-- 分类菜单 -->
      <% if (theme.theme_settings && theme.theme_settings.navbar && theme.theme_settings.navbar.menu) { %>
        <% Object.keys(theme.theme_settings.navbar.menu).forEach(function(key) { %>
          <li<%= is_current(theme.theme_settings.navbar.menu[key]) ? ' class="active"' : '' %>>
            <a href="<%- url_for(theme.theme_settings.navbar.menu[key]) %>" data-translate="<%= key %>"><%= key %></a>
          </li>
        <% }); %>
      <% } %>
      

    </ul>
  </div>
  
  <!-- 搜索框 -->
  <div class="search-overlay" id="search-overlay">
    <div class="search-container">
      <button class="search-close" id="search-close">
        <i class="fa fa-times"></i>
      </button>
      <form class="search-form" id="search-form">
        <div class="search-input-wrapper">
          <input type="text" id="searchInput" class="search-input" placeholder="<%= __('搜索') %>" data-translate-placeholder="搜索">
          <i class="fa fa-search search-icon"></i>
        </div>
        <div id="searchResult" class="search-result-container"></div>
      </form>
    </div>
  </div>
</header>

<!-- 导航栏相关脚本 -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // 移动端菜单切换
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    
    if (mobileMenuBtn && mobileMenu) {
      mobileMenuBtn.addEventListener('click', function() {
        mobileMenu.classList.toggle('active');
        
        // 切换图标
        const icon = mobileMenuBtn.querySelector('i');
        if (icon.classList.contains('fa-bars')) {
          icon.classList.remove('fa-bars');
          icon.classList.add('fa-times');
        } else {
          icon.classList.remove('fa-times');
          icon.classList.add('fa-bars');
        }
        
        // 阻止背景滚动
        document.body.style.overflow = mobileMenu.classList.contains('active') ? 'hidden' : '';
      });
      
      // 点击移动菜单项后关闭菜单
      const mobileMenuLinks = mobileMenu.querySelectorAll('a');
      mobileMenuLinks.forEach(link => {
        link.addEventListener('click', function() {
          mobileMenu.classList.remove('active');
          const icon = mobileMenuBtn.querySelector('i');
          icon.classList.remove('fa-times');
          icon.classList.add('fa-bars');
          document.body.style.overflow = '';
        });
      });
    }
    
    // 搜索框显示/隐藏
    const searchButton = document.getElementById('search-button');
    const searchOverlay = document.getElementById('search-overlay');
    const searchClose = document.getElementById('search-close');
    const searchInput = document.getElementById('searchInput');
    
    if (searchButton && searchOverlay && searchClose && searchInput) {
      searchButton.addEventListener('click', function() {
        searchOverlay.classList.add('active');
        // 延迟获取焦点，确保动画完成
        setTimeout(() => {
          searchInput.focus();
        }, 300);
        document.body.style.overflow = 'hidden';
      });
      
      searchClose.addEventListener('click', function() {
        searchOverlay.classList.remove('active');
        document.body.style.overflow = '';
      });
      
      // 点击搜索框外部关闭
      searchOverlay.addEventListener('click', function(e) {
        if (e.target === searchOverlay) {
          searchOverlay.classList.remove('active');
          document.body.style.overflow = '';
        }
      });
      
      // ESC键关闭搜索框
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && searchOverlay.classList.contains('active')) {
          searchOverlay.classList.remove('active');
          document.body.style.overflow = '';
        }
      });
    }
    
    // 导航栏滚动效果
    const navbar = document.querySelector('.navbar');
    let lastScrollTop = 0;
    
    if (navbar) {
      window.addEventListener('scroll', function() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        
        // 滚动超过100px时添加阴影和背景
        if (scrollTop > 100) {
          navbar.classList.add('navbar-scrolled');
        } else {
          navbar.classList.remove('navbar-scrolled');
        }
        
        // 向下滚动隐藏导航栏，向上滚动显示导航栏
        if (scrollTop > lastScrollTop && scrollTop > 200) {
          navbar.style.transform = 'translateY(-100%)';
        } else {
          navbar.style.transform = 'translateY(0)';
        }
        
        lastScrollTop = scrollTop <= 0 ? 0 : scrollTop; // 避免负值
      });
    }
    
    // 移动端语言选择器同步
    const languageSelector = document.getElementById('language-selector');
    const mobileLanguageSelector = document.getElementById('mobile-language-selector');
    
    if (languageSelector && mobileLanguageSelector) {
      languageSelector.addEventListener('change', function() {
        mobileLanguageSelector.value = this.value;
      });
      
      mobileLanguageSelector.addEventListener('change', function() {
        languageSelector.value = this.value;
        // 触发语言切换
        if (window.Translator) {
          window.Translator.switchLanguage(this.value);
        }
      });
    }
  });
</script>